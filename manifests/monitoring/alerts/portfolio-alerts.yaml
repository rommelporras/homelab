# PrometheusRule for Portfolio Alerts
# Phase 4.28: Monitor availability of public-facing Portfolio site
#
# Metrics used:
#   probe_success{job="portfolio"} â€” HTTP probe reachability (from Blackbox Exporter)
---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: portfolio-alerts
  namespace: monitoring
  labels:
    release: prometheus
    app.kubernetes.io/part-of: kube-prometheus-stack
spec:
  groups:
    - name: portfolio
      rules:
        # Portfolio site unreachable (public service via HTTPRoute)
        - alert: PortfolioDown
          expr: probe_success{job="portfolio"} == 0
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Portfolio site is unreachable"
            description: "Blackbox HTTP probe to portfolio.portfolio-prod.svc:80/health has failed for 5+ minutes. The portfolio site is unavailable."
            runbook: |
              1. Check pod status:
                 kubectl-homelab get pods -n portfolio-prod -l app=portfolio

              2. Check pod logs:
                 kubectl-homelab logs -n portfolio-prod deploy/portfolio --tail=50

              3. Check HTTPRoute:
                 kubectl-homelab get httproute -n portfolio-prod

              4. Check events:
                 kubectl-homelab describe pod -n portfolio-prod -l app=portfolio
