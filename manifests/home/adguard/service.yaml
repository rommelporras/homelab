# AdGuard Home Services
#
# Two services:
# 1. LoadBalancer for DNS (port 53 UDP/TCP) - external access
# 2. ClusterIP for HTTP (port 3000) - internal, exposed via Gateway
#
# IP: 10.10.30.53 (inherited from retired PVE LXC)
---
apiVersion: v1
kind: Service
metadata:
  name: adguard-dns
  namespace: home
  annotations:
    # Cilium L2 announcement - request specific IP for DNS
    io.cilium/lb-ipam-ips: "10.10.30.53"
spec:
  type: LoadBalancer
  # Note: Using Cluster policy for reliable L2 announcement.
  # Local policy requires pod and L2 announcement on same node.
  # TODO: Convert to DaemonSet to restore client IP visibility.
  externalTrafficPolicy: Cluster
  selector:
    app: adguard-home
  ports:
    - name: dns-tcp
      port: 53
      targetPort: 53
      protocol: TCP
    - name: dns-udp
      port: 53
      targetPort: 53
      protocol: UDP
---
# ClusterIP service for web UI (accessed via Gateway API)
apiVersion: v1
kind: Service
metadata:
  name: adguard-http
  namespace: home
spec:
  type: ClusterIP
  selector:
    app: adguard-home
  ports:
    - name: http
      port: 3000
      targetPort: 3000
