# v0.1.0 — Foundation

> **Release:** v0.1.0
> **Phase:** 1
> **Goal:** Ubuntu 24.04 installed on all nodes with SSH access

---

## Overview

This release establishes the hardware foundation:
- 3x Lenovo M80q machines with Ubuntu Server 24.04 LTS
- Static IP configuration on VLAN 30
- SSH access configured for automation

---

## Prerequisites

- 3x Lenovo M80q (i5-10400T, 16GB RAM, 512GB NVMe)
- Ubuntu Server 24.04.3 LTS ISO
- Network switch with VLAN 30 configured
- DNS records for cp{1,2,3}.k8s.rommelporras.com

---

## Step 1: BIOS Configuration

Configure each M80q BIOS before installing Ubuntu:

| Setting | Location | Value |
|---------|----------|-------|
| Virtualization | Security > Virtualization | **Enabled** |
| VT-d | Security > Virtualization | **Enabled** |
| Secure Boot | Security > Secure Boot | **Disabled** |
| Boot Mode | Startup > Boot Mode | **UEFI Only** |
| After Power Loss | Power > After Power Loss | **Power On** |

**After Power Loss = Power On** ensures nodes automatically restart after a power outage.

---

## Step 2: Install Ubuntu Server

Install Ubuntu Server 24.04.3 LTS on each M80q:

1. Boot from USB with Ubuntu Server ISO
2. Select "Ubuntu Server (minimized)" installation
3. Configure network using DHCP (with OPNsense reservations — static IP fields don't persist in the installer)
4. Storage: Entire disk + LVM (ext4). **Important:** default LVM only allocates ~100GB — manually expand `ubuntu-lv` to use the full disk during install.
5. Set hostname during install (k8s-cp1, k8s-cp2, k8s-cp3)
6. Create user: `wawashi`
7. Enable OpenSSH server
8. Skip additional snaps

---

## Step 3: Post-Installation Configuration

SSH to each node and run:

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Verify hostname (should already be set)
hostnamectl

# Verify static IP
ip addr show | grep "10.10.30"
```

### Configure Static IP (if not done during install)

If DHCP was used during install, configure static IP:

```bash
# Edit netplan config
sudo nano /etc/netplan/00-installer-config.yaml
```

Example for k8s-cp1:

```yaml
network:
  version: 2
  ethernets:
    eno1:
      addresses:
        - 10.10.30.11/24
      routes:
        - to: default
          via: 10.10.30.1
      nameservers:
        addresses:
          - 10.10.30.53
          - 10.10.30.54
```

Apply changes:

```bash
sudo netplan apply
```

---

## Step 4: Configure SSH Keys

From your workstation, copy SSH key to all nodes:

```bash
# Generate key if needed
ssh-keygen -t ed25519 -C "homelab"

# Copy to all nodes
ssh-copy-id wawashi@cp1.k8s.rommelporras.com
ssh-copy-id wawashi@cp2.k8s.rommelporras.com
ssh-copy-id wawashi@cp3.k8s.rommelporras.com
```

---

## Step 5: Basic Security Hardening

On each node:

```bash
# Disable password authentication (SSH keys only)
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
sudo systemctl restart sshd

# Enable automatic security updates
sudo apt install -y unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

---

## Verification

```bash
# From workstation, verify SSH access to all nodes
for node in cp1 cp2 cp3; do
    echo "=== $node ==="
    ssh wawashi@$node.k8s.rommelporras.com "hostname && ip a | grep 10.10.30 && uname -r"
done
```

Expected output:
```
=== k8s-cp1 ===
k8s-cp1
    inet 10.10.30.11/24 ...
6.8.0-xx-generic

=== k8s-cp2 ===
k8s-cp2
    inet 10.10.30.12/24 ...
6.8.0-xx-generic

=== k8s-cp3 ===
k8s-cp3
    inet 10.10.30.13/24 ...
6.8.0-xx-generic
```

---

## Checklist

- [ ] Ubuntu 24.04.3 LTS installed on k8s-cp1
- [ ] Ubuntu 24.04.3 LTS installed on k8s-cp2
- [ ] Ubuntu 24.04.3 LTS installed on k8s-cp3
- [ ] Static IPs configured (.11, .12, .13)
- [ ] SSH key authentication working
- [ ] Password authentication disabled

---

## Lessons Learned

| Issue | Cause | Solution |
|-------|-------|----------|
| DHCP not working in installer | Gateway/DNS fields not persisting | Use DHCP with OPNsense reservations |
| LVM only 100GB | Ubuntu installer default | Manually edit `ubuntu-lv` to max size |
| Interface name | Docs said `enp0s31f6` | Actual is `eno1` (Intel I219-LM) |
| Nodes can't reach gateway | VLAN 30 not in Trunk VLAN list | Add VLAN to both Native AND Trunk on switch |

---

## Next Steps

Proceed to [v0.2.0-bootstrap.md](v0.2.0-bootstrap.md) to initialize the Kubernetes cluster.
